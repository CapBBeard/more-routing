<link rel="import" href="../polymer/polymer.html">

<!--
`more-route-if` is a `template`-based element that manages its content
based on whether a route matches the current URL.

It is a facade to a `more-route`, passing `route`/`name` through to it, and
evaluating its content based on whether that route is `active`. Additionally,
you can treat the `more-route-if` as though it were a route for nesting
purposes.


## Named Routes

    <more-route route="/users/:userId" name="user"></more-route>
    <template is="more-route-if" name="user">
      You're looking at user {{params.userId}}.
    </template>


## Declared Routes

    <template is="more-route-if" route="/faq">
      FAQ!
    </template>


## Nested Routes

    <template is="more-route-if" route="/faq">
      FAQ
      <template is="more-route-if" route="/:question">
        Question: {{params.question}}
      </template>
    </template>

-->
<polymer-element name="more-route-if" extends="template">
  <template>
    <more-route id="route" route="{{route}}" name="{{name}}" active="{{active}}"></more-route>
  </template>

  <script>
    Polymer('more-route-if', {
      publish: {
        /**
         * A routing expression used to parse parameters from the window's URL.
         *
         * @attribute route
         * @type String
         */
        route: '',

        /**
         * A unique name for this route, or the name of a route to proxy (if no
         * `route` expression is given).
         *
         * NOTE: Named routes are only evaluated when the element is created!
         * Call `MoreRouting.registerNamedRoute` if you need to do something
         * more dynamic.
         *
         * @attribute name
         * @type String
         */
        name: '',

        /**
         * Whether the route matches the current URL.
         *
         * @attribute active
         * @type Boolean
         */
        active: false,

        /**
         * Whether the route's content is currently visible.
         *
         * If `autoVisibility` is enabled, this is bound to `active`.
         *
         * @attribute visible
         * @type Boolean
         */
        visible: false,

        /**
         * Whether route content should be made visible when the route becomes
         * active.
         *
         * @attribute autoVisibility
         * @type Boolean
         */
        autoVisibility: true,
      },

      observe: {
        '$.route.active': '_setActive',
      },

      // TODO(nevir): Why can't I bind to this with `active="{{active}}" on the
      // `more-route`?
      _setActive: function() {
        this.active = this.$.route.active;
      },

      activeChanged: function() {
        if (this.autoVisibility) {
          this.visible = this.active;
        }
      },

      // TODO(nevir): intro/outro transitions defined by the route?
      visibleChanged: function() {
        if (this.visible) {
          if (!this.content) return;
          // We need to sandbox any current or future nodes inserted by the
          // template, while leaving them in the light DOM. So, wrap 'em:
          this._liveContent = document.createElement('div');
          this._liveContent.containsRoute = this.$.route;
          this._liveContent.setAttribute('content-for-more-route-if', '');
          this._liveContent.appendChild(this.createInstance(this.$.route));
          this.parentNode.insertBefore(this._liveContent, this.nextSibling);
        } else {
          if (this._liveContent) {
            this._liveContent.remove();
          }
        }
      },

      autoVisibilityChanged: function() {
        if (this.autoVisibility) {
          this.visible = this.active;
        }
      },
    });
  </script>
</polymer-element>
